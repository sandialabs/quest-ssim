#:include common.kv

#:import XYGridView ssim.ui.kivy.xygrid.XYGridView
#:import ControlTabs ssim.ui.kivy.control.ControlTabs
#:import MDBoxLayout kivymd.uix.boxlayout.MDBoxLayout
#:import MDDropdownMenu kivymd.uix.menu.MDDropdownMenu
#:import MDDropDownItem kivymd.uix.dropdownitem.MDDropDownItem

#:set ssim_light_blue (0.68, 0.85, 0.90, 1.0)

<MatlabPlotBox>:
    orientation: "vertical"
    pos_hint: {"top":1}

<ConfigurationPanelContent>:
    orientation: "vertical"

    BoxLayout:
        orientation: "horizontal"
        id: filter_options_storage_name

        Label:
            text: "Filter by Storage Name ..."
            color: C(hex_black)

        TextFieldListFilter:
            id: txt_name_filter
            hint_text: "Storage Device Name"
            on_filter_applied: self.parent.parent.changed_text_filter(self)

    BoxLayout:
        orientation: "horizontal"
        id: filter_options_kW

        Label:
            text: "Filter by Storage Size ..."
            color: C(hex_black)

        TextFieldPositiveFloat:
            id: txt_min_kw_filter
            hint_text: "Enter minimum kW"
            size_hint_y: None
            height: 25

        TextFieldPositiveFloat:
            id: txt_max_kw_filter
            hint_text: "Enter maximum kW"
            size_hint_y: None
            height: 25

    BoxLayout:
        orientation: "horizontal"
        id: filter_options_kWh

        Label:
            text: "Filter by Storage Capacity ..."
            color: C(hex_black)

        TextFieldPositiveFloat:
            id: txt_min_kwh_filter
            hint_text: "Enter minimum kWh"
            size_hint_y: None
            height: 25

        TextFieldPositiveFloat:
            id: txt_max_kwh_filter
            hint_text: "Enter maximum kWh"
            size_hint_y: None
            height: 25

    BoxLayout:
        orientation: "horizontal"

        Button:
            id: okBtn
            text: 'Ok'

        Button:
            id: clearBtn
            text: 'Clear'

        Button:
            id: cancelBtn
            text: 'Cancel'
  
            
<BusSearchPanelContent>:
    orientation: "vertical"

    BoxLayout:
        orientation: "horizontal"
        id: name_panel
                   
        TextFieldListFilter:
            id: txt_bus_name_filter
            hint_text: "Filter Busses by Name"
            on_filter_applied: self.parent.parent.changed_text_filter(self)

        Button:
            id: btn_clear_filter_txt
            text: "X"
            size_hint: [.07, 0.5]
            pos_hint: {"top":0.9}
            on_press: self.parent.parent.clear_text_filter()
            
    BoxLayout:
        orientation: "horizontal"
        id: yes_phase_panel
        
        Label:
            text: "Must Have Phase"
            color: C(hex_black)
            size_hint_x: 0.25
            
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_yes_phase_1
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)                
            Label:
                text: "1"
                color: C(hex_black)
                halign: "left"
            
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_yes_phase_2
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
                
            Label:
                text: "2"
                color: C(hex_black)
                halign: "left"

        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_yes_phase_3
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            
            Label:
                text: "3"
                color: C(hex_black)
                halign: "left"
               
    BoxLayout:
        orientation: "horizontal"
        id: no_phase_panel
        
        Label:
            text: "Can't' Have Phase"
            color: C(hex_black)    
            size_hint_x: 0.25
            
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_no_phase_1
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            Label:
                text: "1"
                color: C(hex_black)
                size_hint_x: 0.75
                
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height
                    
            CheckBox:
                id: ckb_no_phase_2
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            Label:
                text: "2"
                color: C(hex_black)
                size_hint_x: 0.75
                
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_no_phase_3
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            Label:
                text: "3"
                color: C(hex_black)
                size_hint_x: 0.75
             
    BoxLayout:
        orientation: "horizontal"
        id: phase_ct_panel
        
        Label:
            text: "Allowed Phase Counts"
            color: C(hex_black)
            size_hint_x: 0.25
            
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_1_phase_ct
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)   
            Label:
                text: "1-phase"
                color: C(hex_black)
            
        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_2_phase_ct
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            Label:
                text: "2-phase"
                color: C(hex_black)
                halign: "left"

        BoxLayout:
            orientation: "horizontal"
            size_hint_x: 0.25
        
            canvas.before:
                Color:
                    rgba: ssim_light_blue
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height

            CheckBox:
                id: ckb_3_phase_ct
                active: False
                on_active: self.parent.parent.parent.changed_phase_filter(self)
            Label:
                text: "3-phase"
                color: C(hex_black)
                halign: "left"

    BoxLayout:
        orientation: "horizontal"
        id: selected_panel

        canvas.before:
            Color:
                rgba: ssim_light_blue
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height

        Label:
            text: "Selected Only"
            color: C(hex_black)
            size_hint_x: 0.25
        CheckBox:
            id: ckb_sel_only
            active: False
            on_active: self.parent.parent.changed_sel_only_filter(self)
            
    BoxLayout:
        id: voltage_panel
        
        canvas.before:
            Color:
                rgba: ssim_light_blue
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height
                
        Label:
            text: "Voltage"
            color: C(hex_black)
            size_hint_x: 0.25
           
        GridLayout:
            cols: 8
            id: voltage_check_panel
            
    BoxLayout:
        orientation: "horizontal"

        Button:
            id: okBtn
            text: 'Ok'

        Button:
            id: clearBtn
            text: 'Clear'
        
        Button:
            id: cancelBtn
            text: 'Cancel'


<SSimScreen>:
    name: 'ssim'

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 30

            Label:
                text: "Project Name:"
                color: C(hex_black)
                size_hint: (0.25, 1.0)

            TextInput:
                id: project_name
                text: "unnamed"
                multiline: False
                valign: "center"
                on_text: root.project.name = project_name.text

        BoxLayout:
            orientation: "horizontal"

            BoxLayout:
                orientation: "vertical"
                size_hint_x: 0.35
                padding: 5
                spacing: 5

                Button:
                    text: "read from file"
                    on_press: root.read_toml()

                BoxLayout:
                    orientation: "horizontal"
                    #size_hint: (1.0, 0.1)
                    spacing: 5

                    Button:
                        text: "save"
                        size_hint: (0.5, 1.0)
                        on_press: root.write_to_toml()

                    Button:
                        text: "save as"
                        size_hint: (0.5, 1.0)
                        on_press: root.write_as_toml()

                Button:
                    text: "select grid model"
                    on_press: root.select_grid_model()

                Button:
                    text: "select DER"
                    on_press: root.open_der_configuration()

                Button:
                    text: "configure reliability"
                    on_press: root.open_reliability_configuration()

                Button:
                    text: "configure metrics"
                    on_press: root.open_metric_configuration()

                Button:
                    text: "Run"
                    on_press: root.do_run_simulation()

            BoxLayout:
                orientation: "vertical"
                id: plot_side_box
                size_hint_x: 0.65

                MDLabel
                    id: grid_model_label
                    size_hint_y: None
                    height: 50
                    text: "Grid Model:"

                MatlabPlotBox:
                    id: grid_diagram

                BoxLayout:
                    id: plt_controls
                    orientation: "horizontal"
                    size_hint_y: None
                    height: 30

                    MDLabel
                        id: show_bus_label
                        size_hint_x: None
                        width: 135
                        text: "Show Bus Labels"

                    CheckBox:
                        id: show_bus_labels
                        size_hint_x: None
                        width: 30
                        active: True
                        on_active: root.changed_show_bus_labels(self.active)
                        
                    MDLabel:
                        id: show_storage_option
                        size_hint_x: None
                        width: 170
                        text: "Show Storage Options"

                    CheckBox:
                        id: show_storage_options
                        size_hint_x: None
                        width: 30
                        active: True
                        on_active: root.changed_show_storage_options(self.active)

                    MDLabel:
                        id: show_pv_option
                        size_hint_x: None
                        width: 170
                        text: "Show PV Options"

                    CheckBox:
                        id: show_pv_options
                        size_hint_x: None
                        width: 30
                        active: True
                        on_active: root.changed_show_pv_options(self.active)


<DERConfigurationScreen>:
    name: "der-config"
    on_enter: root.load_project_data()

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            padding: 5
            size_hint: (1.0, 0.8)

            BoxLayout:
                orientation: "vertical"
                padding: 5

                Label:
                    text: "List of Defined Storage Assets"
                    size_hint: (1.0, 0.05)
                    color: 0,0,0,1

                ScrollView:
                    size_hint: (1.0, 0.75)
                    MDList:
                        id: ess_list

                Button:
                    size_hint: (1.0, 0.1)
                    text: "New Storage"
                    on_press: root.new_storage()

                Button:
                    id: delete_storage
                    size_hint: (1.0, 0.1)
                    text: "Delete Storage"

            BoxLayout:
                orientation: "vertical"
                padding: 5

                Label:
                    text: "List of Defined PV Assets"
                    size_hint: (1.0, 0.05)
                    color: 0,0,0,1

                ScrollView:
                    size_hint: (1.0, 0.75)
                    MDList:
                        id: pv_list

                Button:
                    id: new_pv
                    size_hint: (1.0, 0.1)
                    text: "New PV System"
                    on_press: root.new_pv_system()

                Button:
                    id: delete_pv
                    size_hint: (1.0, 0.1)
                    text: "Delete PV System"

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 30

            Button:
                text: "back"
                on_press: root.manager.current = 'ssim'

            Button:
                text: "save"
                # Might need something different here to handle the
                on_press: root.manager.current = 'ssim'


<StorageListitem>:
    LeftCheckBox:
        id: selected

    IconRightWidget:
        id: edit
        icon: "pencil"


<PVListitem>:
    LeftCheckBox:
        id: selected

    IconRightWidget:
        id: edit
        icon: "pencil"


<ResultsVariableListItemWithCheckbox>:
    id: results_variable_list

    LeftCheckBox:
        id: selected
        listItem: root


<ResultsMetricsListItemWithCheckbox>:
    id: results_metrics_list

    LeftCheckBox:
        id: metrics_selected
        listItem: root


<ResultsListItem>:
    size_hint: 1.0, 0.5
    LeftCheckBox:
        id: selected
        on_active: root.mark(self, self.active)

<ResultsDetailListItem1>:
    size_hint: 1.0, 0.5

    LeftCheckBox:
        id: selected
        on_active: root.mark(self, self.active)

<BusListItem>:
    LeftCheckBox:
        id: selected
        on_active: root.mark(self, self.active)

<ResultsDetailListItem2>:
    size_hint: 1.0, 0.5
    LeftCheckBox:
        id: selected
        on_active: root.mark(self, self.active)

<ConfigListItem>:
    size_hint: 1.0, 0.5
    LeftCheckBox:
        id: selected
        on_active: root.mark(self, self.active)

<DroopTabContent>
    orientation: "vertical"
    padding: 5
    title: "Droop"

    TextFieldFloat:
        id: p_value
        hint_text: "P Droop"

    TextFieldFloat:
        id: q_value
        hint_text: "Q Droop"

    BoxLayout:
        size_hint: (1.0, 0.8)

<ConstPFTabContent>
    orientation: "vertical"
    padding: 5
    title: "Constant Power Factor"

    TextFieldFloat:
        id: pf_value
        hint_text: "Power Factor Value"

    BoxLayout:
        size_hint: (1.0, 0.9)

<VoltVarTabContent>
    orientation: "vertical"
    size_hint: (1.0, 1.0)
    padding: 5
    title: "Volt-Var"

    BoxLayout:
        orientation: "horizontal"

        BoxLayout:
            id: headers
            orientation: "vertical"
            size_hint_x: 0.5

            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.07

                BoxLayout:
                    orientation: "horizontal"

                    MDLabel:
                        id: x_label
                        text: "Voltage (p.u.)"
                        size_hint_y: None
                        height: 25

                    Button:
                        id: resetbtn
                        text: "Reset"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.8
                        on_release: root.on_reset_button()

                    Button:
                        id: sortbtn
                        text: "Sort"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.9
                        on_release: root.on_sort_button()

                MDLabel:
                    id: y_label
                    text: "Reactive Power (p.u.)"
                    size_hint_y: None
                    height: 25

                Button:
                    id: addbtn
                    text: "+"
                    size_hint: None, None
                    size: 25, 25
                    pos_hint_y: 0.9
                    on_release: root.on_add_button()

            XYGridView:
                id: grid
                size_hint: 1.0, 0.93
                on_item_deleted: root.rebuild_plot()
                on_value_changed: root.rebuild_plot()

        MatlabPlotBox:
            id: plot_box
            size_hint_x: 0.5

<VoltWattTabContent>
    orientation: "vertical"
    size_hint: (1.0, 1.0)
    padding: 5
    title: "Volt-Watt"

    BoxLayout:
        orientation: "horizontal"

        BoxLayout:
            id: headers
            orientation: "vertical"
            size_hint_x: 0.5

            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.07

                BoxLayout:
                    orientation: "horizontal"

                    MDLabel:
                        id: x_label
                        text: "Voltage (p.u.)"
                        size_hint_y: None
                        height: 25

                    Button:
                        id: resetbtn
                        text: "Reset"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.8
                        on_release: root.on_reset_button()

                    Button:
                        id: sortbtn
                        text: "Sort"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.9
                        on_release: root.on_sort_button()

                MDLabel:
                    id: y_label
                    text: "Watts (p.u.)"
                    size_hint_y: None
                    height: 25

                Button:
                    id: addbtn
                    text: "+"
                    size_hint: None, None
                    size: 25, 25
                    pos_hint_y: 0.9
                    on_release: root.on_add_button()

            XYGridView:
                id: grid
                size_hint: (1.0, 0.93)
                on_item_deleted: root.rebuild_plot()
                on_value_changed: root.rebuild_plot()

        MatlabPlotBox:
            id: plot_box
            size_hint_x: 0.5

<VarWattTabContent>
    orientation: "vertical"
    size_hint: (1.0, 1.0)
    padding: 5
    title: "Var-Watt"

    BoxLayout:
        orientation: "horizontal"

        BoxLayout:
            id: headers
            orientation: "vertical"
            size_hint_x: 0.5

            BoxLayout:
                orientation: "horizontal"
                size_hint: 1.0, 0.07

                BoxLayout:
                    orientation: "horizontal"

                    MDLabel:
                        id: x_label
                        text: "Reactive Power (p.u.)"
                        size_hint_y: None
                        height: 25

                    Button:
                        id: resetbtn
                        text: "Reset"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.8
                        on_release: root.on_reset_button()

                    Button:
                        id: sortbtn
                        text: "Sort"
                        size_hint: None, None
                        size: 45, 25
                        pos_hint_y: 0.9
                        on_release: root.on_sort_button()

                MDLabel:
                    id: y_label
                    text: "Watts (p.u.)"
                    size_hint_y: None
                    height: 25

                Button:
                    id: addbtn
                    text: "+"
                    size_hint: None, None
                    size: 25, 25
                    pos_hint_y: 0.9
                    on_release: root.on_add_button()

            XYGridView:
                id: grid
                size_hint: (1.0, 0.93)
                on_item_deleted: root.rebuild_plot()
                on_value_changed: root.rebuild_plot()

        MatlabPlotBox:
            id: plot_box
            size_hint_x: 0.5


<VoltVarVoltWattTabContent>
    orientation: "horizontal"
    size_hint: (1.0, 1.0)
    padding: 5
    title: "Volt-Var & Volt-Watt"

    BoxLayout:
        orientation: "vertical"
        size_hint_x: 0.5

        ScrollView:
            BoxLayout:
                orientation: "vertical"
                padding: 12

                canvas.before:
                    Color:
                        rgba: .5, .5, .5, 1
                    Line:
                        width: 2
                        rectangle: self.x, self.y, self.width, self.height

                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: 0.07

                    BoxLayout:
                        orientation: "horizontal"

                        MDLabel:
                            id: x_label
                            text: "Voltage (p.u.)"
                            size_hint_y: None
                            height: 25

                        Button:
                            id: resetvvbtn
                            text: "Reset"
                            size_hint: None, None
                            size: 45, 25
                            pos_hint_y: 0.8
                            on_release: root.on_reset_vv_button()

                        Button:
                            id: sortvvbtn
                            text: "Sort"
                            size_hint: None, None
                            size: 45, 25
                            pos_hint_y: 0.9
                            on_release: root.on_sort_vv_button()

                    MDLabel:
                        id: y_label
                        text: "Reactive Power (p.u.)"
                        size_hint_y: None
                        height: 25

                    Button:
                        id: addvvbtn
                        text: "+"
                        size_hint: None, None
                        size: 25, 25
                        pos_hint_y: 0.9
                        on_release: root.on_add_vv_button()

                XYGridView:
                    id: vv_grid
                    size_hint_y: 0.93
                    on_item_deleted: root.rebuild_plot()
                    on_value_changed: root.rebuild_plot()

        ScrollView:
            BoxLayout:
                orientation: "vertical"
                padding: 12

                canvas.before:
                    Color:
                        rgba: .5, .5, .5, 1
                    Line:
                        width: 2
                        rectangle: self.x, self.y, self.width, self.height

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: 1.0, 0.07

                    BoxLayout:
                        orientation: "horizontal"

                        MDLabel:
                            id: x_label
                            text: "Voltage (p.u.)"
                            size_hint_y: None
                            height: 25

                        Button:
                            id: resetvwbtn
                            text: "Reset"
                            size_hint: None, None
                            size: 45, 25
                            pos_hint_y: 0.8
                            on_release: root.on_reset_vw_button()

                        Button:
                            id: sortvwbtn
                            text: "Sort"
                            size_hint: None, None
                            size: 45, 25
                            pos_hint_y: 0.9
                            on_release: root.on_sort_vw_button()

                    MDLabel:
                        id: y_label
                        text: "Watts (p.u.)"
                        size_hint_y: None
                        height: 25

                    Button:
                        id: addvwbtn
                        text: "+"
                        size_hint: None, None
                        size: 25, 25
                        pos_hint_y: 0.9
                        on_release: root.on_add_vw_button()

                XYGridView:
                    id: vw_grid
                    size_hint: (1.0, 0.93)
                    on_item_deleted: root.rebuild_plot()
                    on_value_changed: root.rebuild_plot()

    MatlabPlotBox:
        id: plot_box
        size_hint_x: 0.5


<NoControl>:
    padding: 4
    title: "Uncontrolled"

    Label:
        id: ucmodelabel
        text: "Uncontrolled"


<StorageControlConfigurationScreen>:
    name: "configure-storage-controls"
    on_enter: self.set_mode_label_text()

    BoxLayout:
        orientation: "vertical"
        padding: 5

        TextFieldPositivePercentage:
            id: min_soc
            hint_text: "Minimum State of Charge (%)"

        TextFieldPositivePercentage:
            id: max_soc
            hint_text: "Maximum State of Charge (%)"

        TextFieldPositivePercentage:
            id: init_soc
            hint_text: "Initial State of Charge (%)"

        Label:
            id: mode_label
            markup: True
            text: "Select a control mode for this storage asset:"
            color: C(hex_black)
            size_hint_y: None
            height: 25

        BoxLayout:
            size_hint: (1.0, 0.2)

            ControlTabs:
                id: tabs
                lock_swiping: True
                enabled_controls: ["droop", "voltvar", "voltwatt", "varwatt", "vv_vw", "constantpf"]

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Button:
                text: "back"
                on_press: root.cancel()

            Button:
                text: "save"
                on_press: root.save()


<StorageConfigurationScreen>:
    name: "configure-storage"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"

            BoxLayout:
                orientation: "vertical"
                padding: 5

                TextFieldOpenDSSName:
                    id: device_name
                    hint_text: "Device Name"
                    helper_text_mode: "on_error"
                    helper_text: "invalid name"

                BoxLayout:
                    orientation: "vertical"
                    padding: 5

                    canvas.before:
                        Color:
                            rgba: ssim_light_blue
                        Line:
                            width: 1
                            rectangle: self.x, self.y, self.width, self.height

                    TextFieldPositiveFloat:
                        id: power_input
                        hint_text: "Storage Device Power (kW)"

                    MDScrollView:
                        EditableSetList:
                            id: power_list

                BoxLayout:
                    orientation: "vertical"
                    padding: 5

                    canvas.before:
                        Color:
                            rgba: ssim_light_blue
                        Line:
                            width: 1
                            rectangle: self.x, self.y, self.width, self.height

                    TextFieldPositiveFloat:
                        id: duration_input
                        hint_text: "Storage Device Duration (hours)"

                    MDScrollView:
                        EditableSetList:
                            id: duration_list

            BoxLayout:
                id: right_box
                orientation: "vertical"
                padding: 5
                spacing: 10

                FilterableBusList:
                    id: select_busses

                BoxLayout:
                    size_hint_y: None
                    height: 25
                    orientation: "horizontal"
                    padding: [0, 0, 20, 0]

                    MDLabel:
                        id: required_label
                        text: "Required?"

                    MDSwitch:
                        id: required
                        active: False
                        size_hint: [0.08, 1.0]

                Button:
                    text: "Edit Control Parameters"
                    size_hint_y: None
                    height: 30
                    on_press: root.edit_control_params()

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Button:
                text: "back"
                on_press: root.cancel()

            Button:
                text: "save"
                on_press: root.save()


<PVControlConfigurationScreen>:
    name: "configure-pv-controls"

    BoxLayout:
        orientation: "vertical"
        padding: 5

        # TODO may want to expose the OpenDSS "%cutin" & "%cutout" parameters here

        Label:
            id: mode_label
            markup: True
            text: "Select a control mode for this PV system:"
            color: C(hex_black)
            size_hint_y: None
            height: 25

        BoxLayout:
            size_hint: (1.0, 0.2)

            ControlTabs:
                id: tabs
                lock_swiping: True
                enabled_controls: ["uncontrolled", "voltvar", "voltwatt", "varwatt", "vv_vw", "constantpf"]

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Button:
                text: "back"
                on_press: root.cancel()

            Button:
                text: "save"
                on_press: root.save()


<PVConfigurationScreen>:
    id: "configure-pv"

    BoxLayout:
        orientation: "vertical"
        padding: 5

        BoxLayout:
            orientation: "horizontal"
            padding: 5

            BoxLayout:
                orientation: "vertical"
                padding: 5

                TextFieldOpenDSSName:
                    id: device_name
                    hint_text: "Device Name"
                    helper_text_mode: "on_error"
                    helper_text: "invalid name"

                TextFieldPositiveFloat:
                    id: pmpp_input
                    hint_text: "PV System Max AC Power (kW)"

                MDScrollView:
                    EditableSetList:
                        id: pmpp_list

                MDLabel:
                    id: irradiance_path
                    text: "Select a file containing the irradiance profile"

                Button:
                    id: select_irradiance
                    size_hint_y: None
                    height: 30
                    text: "Select irradiance profile"

            BoxLayout:
                id: bus_list_box
                orientation: "vertical"
                padding: 5
                spacing: 10

                FilterableBusList:
                    id: select_busses

                BoxLayout:
                    size_hint_y: None
                    height: 25
                    orientation: "horizontal"
                    padding: [0, 0, 20, 0]

                    MDLabel:
                        id: required_label
                        text: "Required?"
                        
                    MDSwitch:
                        id: required
                        active: False
                        size_hint: [0.08, 1.0]
                        
                Button:
                    text: "Edit Control Parameters"
                    size_hint_y: None
                    height: 30
                    on_press: root.edit_control_params()

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Button:
                text: "back"
                on_press: root.cancel()

            Button:
                text: "save"
                on_press: root.save()


<ReliabilityParam@TextFieldPositiveFloat>:
    helper_text_mode: "on_error"


<GeneratorReliabilityParams@ReliabilityModelTab>:
    cols: 5
    rows: 3
    adaptive_height: True
    spacing: 25
    padding: 12
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    model_name: "generator"

    MDLabel:
        font_style: "H6"
        text: "Failure Mode"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Active"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "MTBF (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Min. Repair Time (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Max. Repair Time (hours)"
        halign: "center"

    MDLabel:
        text: "Aging"
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    MDCheckbox:
        id: aging_active
        active: False
    ReliabilityParam:
        id: aging_mtbf
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: aging_repair_min
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: aging_repair_max
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

    MDLabel:
        text: "Wearout"
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    MDCheckbox:
        id: wearout_active
        active: False
    ReliabilityParam:
        id: wearout_mtbf
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: wearout_repair_min
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: wearout_repair_max
        pos_hint: {"center_x": 0.5, "center_y": 0.5}


<ReliabilityParamProbability@ReliabilityParam>:
    minimum: 0.0
    maximum: 1.0


<SwitchReliabilityParams@ReliabilityModelTab>:
    cols: 7
    rows: 2
    adaptive_height: True
    spacing: 25
    padding: 12
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    model_name: "switch"

    MDLabel:
        font_style: "H6"
        text: "Active"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "MTBF (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Min. Repair Time (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Max. Repair Time (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Prob. Fail Open"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Prob. Fail Closed"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Prob. Fail Current"
        halign: "center"

    MDCheckbox:
        id: enabled
        active: False
    ReliabilityParam:
        id: switch_mtbf
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: switch_repair_min
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: switch_repair_max
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParamProbability:
        id: switch_p_open
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParamProbability:
        id: switch_p_closed
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParamProbability:
        id: switch_p_current
        pos_hint: {"center_x": 0.5, "center_y": 0.5}


<LineReliabilityParams@ReliabilityModelTab>:
    model_name: "line"
    cols: 4
    rows: 2
    adaptive_height: True
    spacing: 25
    padding: 12
    pos_hint: {"center_x": 0.5, "center_y": 0.5}

    MDLabel:
        font_style: "H6"
        text: "Active"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "MTBF (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Min. Repair Time (hours)"
        halign: "center"
    MDLabel:
        font_style: "H6"
        text: "Max. Repair Time (hours)"
        halign: "center"

    MDCheckbox:
        id: enabled
        active: False
    ReliabilityParam:
        id: line_mtbf
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: line_repair_min
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
    ReliabilityParam:
        id: line_repair_max
        pos_hint: {"center_x": 0.5, "center_y": 0.5}


<ReliabilityConfigurationScreen>:
    name: "reliability-config"

    BoxLayout:
        orientation: "vertical"

        # TODO Add seed.

        MDTabs:
            id: reliability_models

            GeneratorReliabilityParams:
                id: generator_reliability
                title: "Generators"

            LineReliabilityParams:
                id: line_reliability
                title: "Lines"

            SwitchReliabilityParams:
                id: switch_reliability
                title: "Switches"

        BoxLayout:
            orientation: "horizontal"
            Button:
                id: save
                text: "save"
                size_hint_y: None


<LoadConfigurationScreen>:
    name: "load-config"

    BoxLayout:
        orientation: "vertical"

        Label:
            id: currMetriclabel
            text: "Defined Metrics"
            size_hint: 1.0, 0.05
            color: 0,0,0,1

        ScrollView:
            MDList:
                id: metriclist

        Button:
            text: "back"
            on_press: root.manager.current = 'ssim'

<MetricListItem>:

    bus: ' '

    IconRightWidget:
        id: trash_can
        icon: 'trash-can-outline'
        listItem: root

    IconLeftWidget:
        id: left_icon
        icon: 'chart-line'

<BusListItemWithCheckbox>:

    IconRightWidget:
        icon: root.icon

    LeftCheckBox:
        id: check
        listItem: root

<XYGridView>
    viewclass: 'XYGridViewItem'
    #size_hint: 0.5, 0.93

    RecycleBoxLayout:
        default_size: None, dp(32)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False


<FilterableBusList@BoxLayout>:
    id: bus_list_box
    orientation: "vertical"
    padding: 5
    spacing: 10

    MDLabel:
        text: "Select possible busses"
        size_hint: (1.0, 0.05)
        underline: True

    Button:
        id: filter_busses_btn
        text: "Filter Busses"
        size_hint: (1.0, 0.05)
        on_press: root.open_bus_filters()

    BusRecycleView:
        id: bus_list
        project: root.project


<BusRecycleView@RecycleView>:
    viewclass: 'BusListItem'
    padding: [0, 0, 10, 0]
    
    RecycleBoxLayout:
        padding: [0, 5, 0, 0]
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<ResultsListRecycleView>:
    viewclass: 'ResultsListItem'
    padding: [0, 0, 10, 0]
    
    RecycleBoxLayout:
        padding: [0, 5, 0, 0]
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<ResultsDetailListRecycleView1>:
    viewclass: 'ResultsDetailListItem1'
    padding: [0, 0, 10, 0]
    
    RecycleBoxLayout:
        padding: [0, 5, 0, 0]
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<ResultsDetailListRecycleView2>:
    viewclass: 'ResultsDetailListItem2'
    padding: [0, 0, 10, 0]
    
    RecycleBoxLayout:
        padding: [0, 5, 0, 0]
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<ConfigurationRecycleView>:
    viewclass: 'ConfigListItem'
    padding: [0, 0, 30, 0]

    RecycleBoxLayout:
        padding: [5, 25, 5, 5]
        default_size: None, dp(80)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        multiselect: False
        touch_multiselect: False

<XYItemTextField>
    multiline: False

<XYGridViewItem>
    orientation: 'horizontal'
    padding: 2

    XYItemTextField:
        id: x_field
        on_focus : root.on_x_focus_changed(self, self.focused)
        on_text_validate : root.on_x_value_changed(self, self.text)

    XYItemTextField:
        id: y_field
        on_focus : root.on_y_focus_changed(self, self.focused)
        on_text_validate : root.on_y_value_changed(self, self.text)

    Button:
        id: deletebtn
        text: "X"
        size_hint_x: None
        width: 25
        pos_hint_y: 0.9
        on_release: root.on_delete_button()

<MetricConfigurationScreen>:
    name: "metric-config"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            #cols: 3
            orientation: "horizontal"

            BoxLayout:
                orientation: "vertical"

                Label:
                    text: "Class of Metrics to Configure"
                    size_hint: 1.0, 0.05
                    color: 0,0,0,1

                ScrollView:

                    MDList:
                        id: metriclist

                        TwoLineIconListItem:
                            text: "Bus Voltages"
                            secondary_text: "set voltage targets by bus"
                            icon: "plus"
                            on_release: root.configure_voltage_metrics()

                        #TwoLineIconListItem:
                        #    text: "Some other metric values"
                        #    secondary_text: "set ..."
                        #    icon: "plus"
                        #    on_release: root.configure_some_other_metrics()

            BoxLayout:
                id: interlistheader
                orientation: "vertical"
                spacing: 10

                Label:
                    id: interlabel
                    text: "Metric Objects"
                    size_hint: 1.0, 0.05
                    color: 0,0,0,1

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: None, None
                    size: self.parent.width, 10

                    Button:
                        id: btnSelectAll
                        text: "Select All"
                        size_hint: 0.5, None
                        size: self.parent.width, 10
                        on_release: root.select_all_metric_objects()
                        disabled: True

                    Button:
                        id: btnDeselectAll
                        text: "Deselect All"
                        size_hint: 0.5, None
                        size: self.parent.width, 10
                        on_release: root.deselect_all_metric_objects()
                        disabled: True
                
                RecycleView:
                    id: interlist
    
                    RecycleBoxLayout:
                        padding: [0, 5, 0, 0]
                        default_size: None, dp(56)
                        default_size_hint: 1, None
                        size_hint_y: None
                        height: self.minimum_height
                        orientation: 'vertical'
                        multiselect: False
                        touch_multiselect: False

            BoxLayout:
                orientation: "vertical"

                BoxLayout:
                    id: metricValueBox
                    orientation: "vertical"
                    size_hint_y: None
                    height: 320
                    disabled: True
                    padding: 10

                    Label:
                        id: metriclabel
                        text: "Metric Settings"
                        size_hint_y: None
                        height: 25
                        color: 0,0,0,1

                    BoxLayout:
                        id: metricSenseBox
                        orientation: "horizontal"
                        size_hint_y: None
                        height: 35
                        disabled: True

                        MDRaisedButton:
                            id: min_btn
                            selected: False
                            text: "Minimize"
                            size_hint: 0.33, None
                            #size: self.parent.width, 25
                            on_release: root.set_minimize_sense()

                        MDRaisedButton:
                            id: max_btn
                            selected: False
                            text: "Maximize"
                            size_hint: 0.33, None
                            #size: self.parent.width, 25
                            on_release: root.set_maximize_sense()

                        MDRaisedButton:
                            id: seek_btn
                            selected: False
                            text: "Seek Value"
                            size_hint: 0.33, None
                            #size: self.parent.width, 25
                            on_release: root.set_seek_value_sense()

                    TextFieldMultiFloat:
                        hint_text: "Lower Limit Value"
                        size_hint_y: None
                        height: 25
                        id: lowerLimitText

                    TextFieldMultiFloat:
                        hint_text: "Objective Value"
                        size_hint_y: None
                        height: 25
                        id: objectiveText

                    TextFieldMultiFloat:
                        hint_text: "Upper Limit Value"
                        size_hint_y: None
                        height: 25
                        id: upperLimitText

                    Button:
                        id: btnStore
                        text: "store"
                        size_hint_y: None
                        height: 25
                        on_release: root.store_metrics()
                        disabled: True

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: 40

                    Label:
                        id: currMetriclabel
                        text: "Defined Metrics"
                        size_hint: 1.0, 0.05
                        color: 0,0,0,1

                    ScrollView:
                        MDList:
                            id: metriclist

        Button:
            text: "back"
            size_hint: 1.0, 0.05
            on_press: root.manager.current = 'ssim'

<RunSimulationScreen>:
    name: "run-sim"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            padding: 5

            BoxLayout:
                orientation: "vertical"
                padding: 5

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: None, None
                    size: self.parent.width, 50
                    
                    Button:
                        id: btnSelectAll
                        text: "Select All"
                        size_hint: 0.5, 1.0
                        on_release: root.select_all_configurations()
                        disabled: True

                    Button:
                        id: btnDeselectAll
                        text: "Deselect All"
                        size_hint: 0.5, 1.0
                        on_release: root.deselect_all_configurations()
                        disabled: True
                
                Button:
                    id: filter_busses_btn
                    text: "Filter Configuration"
                    size_hint: (1.0, 0.05)
                    on_press: root.open_config_filters()

                ConfigurationRecycleView:
                    id: config_list_recycle

            BoxLayout:
                orientation: "vertical"
                padding: 5
                spacing: 5

                Button:
                    text: "View Saved Results"

                Button:
                    text: "Visualize Results"
                    on_release: root.open_visualize_results()

                Button:
                    text: "Resume"

                TextFieldPositiveFloat:
                    hint_text: "Enter Simulation Time (in hours, Default 24 hours)"
                    size_hint_y: None
                    height: 25
                    id: simulation_runtime    

                Button:
                    id: run_configuration_btn
                    text: "Run Selected Configurations"
                    disabled: True
                    on_press: root.run_configurations()

        Button:
            text: "back"
            size_hint_y: None
            height: 100
            on_press: root.manager.current = 'ssim'

<ResultsDetailScreen>:
    name: "results-detail"
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            padding: 5

            BoxLayout:
                id: detail_plot_canvas
                size_hint_x: 2.0
                orientation: "vertical"
                padding: 5
                spacing: 5
                Label:
                    text: "Plot Will Be Displayed Here!"
                    color: 0, 0, 0, 1

            BoxLayout:
                id: right_bar
                orientation: "vertical"

                BoxLayout:
                    id: drop_down_menus
                    orientation: "vertical"
                    size_hint_y: 0.6
                    Label:
                        text: "Select Configuration:"
                        color: 0,0,0,1
                        size_hint_y: 0.1

                    MDRaisedButton:
                        id: config_list_detail
                        text: "Select Configuration ... "
                        size_hint_x: 1.0
                        on_release: root.drop_config_menu()

                    Label:
                        text: "Select Variable(s) for Plot 1:"
                        color: 0,0,0,1
                        size_hint_y: 0.1

                    ResultsDetailListRecycleView1:
                        id: variable_list_detail_axes_1_recycle

                    # ScrollView:
                    #     canvas.before:
                    #         Color:
                    #             rgba: .5, .5, .5, 1
                    #         Line:
                    #             width: 2
                    #             rectangle: self.x, self.y, self.width, self.height
                    #     MDList:
                    #         id: variable_list_detail_axes_1

                    Label:
                        text: "Select Variable(s) for Plot 2:"
                        color: 0,0,0,1
                        size_hint_y: 0.1

                    ResultsDetailListRecycleView2:
                        id: variable_list_detail_axes_2_recycle

                    # ScrollView:
                    #     canvas.before:
                    #         Color:
                    #             rgba: .5, .5, .5, 1
                    #         Line:
                    #             width: 2
                    #             rectangle: self.x, self.y, self.width, self.height
                    #     MDList:
                    #         id: variable_list_detail_axes_2

                BoxLayout:
                    orientation: 'vertical'
                    id: label_inputs
                    size_hint_y: 0.2
                    
                    MDTextField:
                        id: detail_figure_title
                        hint_text: 'Enter title ...'
                        size_hint_y: 0.9

                    MDTextField:
                        id: detail_figure_ylabel
                        hint_text: 'Enter Y-axis-1 label ...'
                        size_hint_y: 0.9

                    MDTextField:
                        id: detail_figure_ylabel2
                        hint_text: 'Enter Y-axis-2 label ...'
                        size_hint_y: 0.9
                
                BoxLayout:
                    orientation: 'vertical'
                    id: plot_buttons
                    size_hint_y: 0.1
                
                    BoxLayout:
                        orientation: 'horizontal'
                        
                        Button:
                            text: "Update Figure"
                            on_release: root.update_figure()
                        
                        Button:
                            text: "Clear Figure"
                            on_release: root.clear_figure()
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Save Figure"
                            on_release: root.save_figure_options()

        Button:
            text: "back"
            size_hint_y: None
            on_press: root.manager.current = 'results-visualize'

<ResultsVisualizeScreen>:
    name: "results-visualize"

    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            padding: 5

            BoxLayout:
                id: summary_canvas
                size_hint_x: 2.0
                orientation: "vertical"
                padding: 5
                spacing: 5

            BoxLayout:
                orientation: "vertical"
                id: controls
                
                BoxLayout:
                    orientation: "vertical"
                    padding: 5
                    size_hint_y: 0.6

                    BoxLayout:
                        orientation: "horizontal"

                        BoxLayout:
                            orientation: "vertical"
                            padding: 5
                            spacing: 5

                            Label:
                                size_hint_y: 0.1
                                text: "Select Configuration:"
                                color: 0,0,0,1
                            MDRaisedButton:
                                id: config_list_detail_metrics
                                text: "Select Configuration ... "
                                size_hint_x: 1.0
                                on_release: root.drop_config_menu_metrics()
                            Label:
                                size_hint_y: 0.1
                                text: "Select Metric(s) to Plot:"
                                color: 0,0,0,1

                            ResultsListRecycleView:
                                id: metrics_list_recycle
                            
                            BoxLayout:
                                id: voltage_controls
                                orientation: "horizontal"
                                size_hint: 1.0, 0.1
                                height: 10
                                padding: 5
                                spacing: 5

                                MDLabel:
                                    id: show_voltage_overlay
                                    padding: 5, 5
                                    spacing: 5
                                    size_hint_x: 0.7
                                    text: "Show Bus Voltage"

                                CheckBox:
                                    id: show_bus_voltages
                                    padding: 5
                                    spacing: 5
                                    size_hint_x: 0.3
                                    active: True
                                    on_active: root.changed_show_voltage(self.active)

                BoxLayout:
                    orientation: "vertical"
                    padding: 5
                    spacing: 5
                    size_hint_y: 0.3
                    MDTextField:
                        id: detail_figure_title
                        hint_text: 'Enter custom title ...'
                    Button:
                        size_hint_y: 0.1
                        text: "Update Figure"
                        on_release: root.update_metrics_figure()
                    Button:
                        size_hint_y: 0.1
                        text: "Clear Figure"
                        on_release: root.clear_metrics_figure()
                    Button:
                        size_hint_y: 0.1
                        text: "Save Figure"
                        on_release: root.save_figure_options_metrics()
                    Button:
                        size_hint_y: 0.1
                        text: "View Details"
                        on_press: root.open_results_detail()

        Button:
            text: "back"
            size_hint_y: None
            on_press: root.manager.current = 'run-sim'


<EditableSetListItem>:

    IconRightWidget:
        id: delete
        icon: "trash-can-outline"


<ListItemWithCheckbox>:
    id: the_list_item

    LeftCheckbox:
        id: selected
        listItem: root

    IconRightWidget:
        id: delete_config
        icon: 'trash-can-outline'
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1
        on_release:
            root.delete_item(the_list_item)


<SelectFileDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            path: "."

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Ok"
                on_release: root.load(filechooser.path, filechooser.selection)


<SelectGridDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.dss"]

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<LoadSSIMTOMLDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.toml"]

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveSSIMTOMLDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.toml"]
            dirselect: True
            on_selection: root.manage_filename_field()

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Label:
                text: "Filename:"
                size_hint: 0.1, 1.0

            TextInput:
                id: filenamefield
                multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.selection or [filechooser.path], filenamefield.text)

<MetricsNoGridPopupContent>:
    orientation: "vertical"

    Label:
        text: 'A grid model has not yet been selected.  Please return to the main screen and choose a grid model before attempting to set voltage metrics.'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2

    Button:
        id: mainScreenBtn
        text: 'Return to Main Screen'
        size_hint: 1, 0.2

<MessagePopupContent>:
    orientation: "vertical"

    Label:
        id: msg_label
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2

<MissingMetricValuesPopupContent>:
    orientation: "vertical"

    Label:
        text: 'Not all metric values have been properly specified.  Be sure to enter numbers for ""Upper Limit"", ""Lower Limit"", and ""Objective"" and select a ""Sense"".'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2
        
<MetricsInfoPopupContent>:
    orientation: "vertical"

    Label:
        id: msg_label
        text: ''
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2


<NoGridPopupContent>:
    Label:
        text: 'A grid model has not yet been selected.  Please return to the main screen and choose a grid model before continuing.'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2


<NoGridFilePopupContent>:
    Label:
        text: 'A grid model file was not selected.  You must choose an OpenDSS file as the grid model.'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2

<NoFigurePopupContent>:
    Label:
        text: 'No figure(s) created. Please return to the Results page to create a figure first before saving.'
        text_size: self.width, None
        height: self.texture_size[1]

    Button:
        id: dismissBtn
        text: 'Dismiss'
        size_hint: 1, 0.2

<SaveFigureDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            path: "."
            filters: ["*.png"]
            dirselect: True
            on_selection: root.manage_filename_field()

        BoxLayout:
            size_hint_y: None
            height: 30
            orientation: "horizontal"

            Label:
                text: "Filename:"
                size_hint: 0.1, 1.0

            TextInput:
                id: filenamefield
                multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30

            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.selection or [filechooser.path], filenamefield.text)


<RunProgressPopupContent>:
    orientation: "vertical"

    Label:
        id: info
        text: ""
        height: 30

    ProgressBar:
        id: progress

    Button:
        id: dismissBtn
        text: 'Cancel'
        size_hint: 1, 0.2
